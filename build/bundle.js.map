{"version":3,"sources":["webpack:///webpack/bootstrap 693b333c9b2ad72ebab8","webpack:///./src/index.js","webpack:///./src/layoutGenerator.js","webpack:///./src/vec.js","webpack:///./src/mapNode.js","webpack:///./src/mapHalfEdge.js","webpack:///./src/mapEdge.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 693b333c9b2ad72ebab8\n **/","var layoutGenerator = require('./layoutGenerator.js');\r\n\r\n\r\nvar nodeGoal = 2000;\r\nvar iterCount = 30;\r\n\r\nvar w = window.innerWidth;\r\nvar h = window.innerHeight;\r\nvar sqrSize = Math.min(w, h);\r\n\r\nvar map = d3.select('#map-container')\r\n    .append('canvas')\r\n        .attr('width', w)\r\n        .attr('height', h);\r\nvar sx = d3.scale.linear().domain([-3, 3]).range([0, sqrSize]);\r\nvar sy = d3.scale.linear().domain([-3, 3]).range([0, sqrSize]);\r\nvar ctx = map.node().getContext('2d');\r\n\r\nvar city = layoutGenerator();\r\n\r\nvar step = 0;\r\n(function animate() {\r\n    var start = Date.now();\r\n    var state = city.generate().state;\r\n\r\n    var rangeX = d3.extent(state.streets.nodes.map(node => node.pos[0]));\r\n    var rangeY = d3.extent(state.streets.nodes.map(node => node.pos[0]));\r\n    var rangeU = d3.extent(rangeX.concat(rangeY));\r\n    sx.domain(rangeU);\r\n    sy.domain(rangeU);\r\n\r\n    console.log();\r\n    console.log(Date.now() - start, 'ms per step', step);\r\n\r\n    ctx.clearRect(0, 0, w, h);\r\n    drawCanvas(state.streets.edges, ctx);\r\n    drawCanvasDistr(state.districts, ctx, state.streets.nodes);\r\n\r\n    if (state.streets.nodes.length < nodeGoal && step++ < iterCount)\r\n        window.requestAnimationFrame(animate);\r\n}());\r\n\r\nfunction drawCanvas(streets, ctx) {\r\n    console.log(streets.length, 'streets');\r\n    streets.forEach(function(edge) {\r\n        ctx.beginPath();\r\n        if (edge.forw.free && edge.back.free)\r\n            ctx.strokeStyle = 'black';\r\n        else if (edge.forw.free || edge.back.free)\r\n            ctx.strokeStyle = 'green';\r\n        else\r\n            ctx.strokeStyle = 'red';\r\n        ctx.moveTo(sx(edge.from.pos[0]), sy(edge.from.pos[1]));\r\n        ctx.lineTo(sx(edge.to.pos[0]), sy(edge.to.pos[1]));\r\n        ctx.stroke();\r\n    });\r\n}\r\n\r\nfunction drawCanvasDistr(dists, ctx, nodes) {\r\n    // var debug = [];\r\n    dists.forEach(function(bord) {\r\n        // debug.push(bord.map(n => nodes.indexOf(n)).join(' '))\r\n        ctx.fillStyle = 'rgba(' + randi(0, 255) + ',' + randi(0, 255) + ',0,.8)';\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(sx(bord[0].pos[0]), sy(bord[0].pos[1]));\r\n        bord.slice(1).forEach(function(node) {\r\n            ctx.lineTo(sx(node.pos[0]), sy(node.pos[1]));\r\n        });\r\n        ctx.closePath();\r\n        ctx.fill();\r\n    });\r\n    ctx.fillStyle = '#fff';\r\n\r\n    console.log(dists.length, 'districts');\r\n    // console.log(debug.sort().join('\\n'));\r\n}\r\n\r\nfunction drawSVG(streets, map) {\r\n    var join = map.selectAll('line.road').data(streets);\r\n    join.enter()\r\n        .append('line')\r\n        .attr('class', 'road')\r\n        .attr({\r\n            x1: edge => sx(edge.from.pos[0]),\r\n            y1: edge => sy(edge.from.pos[1]),\r\n            x2: edge => sx(edge.to.pos[0]),\r\n            y2: edge => sy(edge.to.pos[1])\r\n        });\r\n    join.exit().remove();\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","var vec = require('./vec.js');\r\nvar mapNode = require('./mapNode.js');\r\nvar mapHalfEdge = require('./mapHalfEdge.js');\r\nvar mapEdge = require('./mapEdge.js');\r\n\r\n\r\nfunction aff(val, min, max) {\r\n    return min + val * (max - min);\r\n}\r\n\r\nfunction prng(min, max) {\r\n    return aff(1/3 * (Math.random() + Math.random() + Math.random()), min, max);\r\n}\r\n\r\nfunction randi(min, max) {\r\n    return Math.floor(aff(Math.random(), min, max));\r\n}\r\n\r\n\r\nfunction layoutGenerator() {\r\n    if (!(this instanceof layoutGenerator))\r\n        return new layoutGenerator();\r\n    var start = mapNode(0, 0);\r\n    start.pivots.push(0, Math.PI / 2, Math.PI, -Math.PI / 2);\r\n    this.state = {\r\n        streets: {\r\n            nodes: [start],\r\n            edges: []\r\n        },\r\n        districts: [],\r\n\r\n        spread: .3,\r\n        snapR: .4,\r\n        short: .5,\r\n        long: 1\r\n    };\r\n};\r\n\r\nlayoutGenerator.prototype.removeCycle = function (border) {\r\n    border.forEach(function (halfEdge) {\r\n        halfEdge.free = false;\r\n    });\r\n};\r\n\r\nlayoutGenerator.prototype.addEdge = function(edge) {\r\n    this.state.streets.edges.push(edge);\r\n    return this;\r\n}\r\n\r\nlayoutGenerator.prototype.cycleFromHalfEdge = function(halfEdge0) {\r\n    var depth = 0;\r\n    var halfEdge = halfEdge0;\r\n    var path = [halfEdge0];\r\n\r\n    while (depth < 100) {\r\n        halfEdge = halfEdge.next();\r\n\r\n        if (!halfEdge || halfEdge === path[path.length - 1].twin)\r\n            return false;\r\n\r\n        if (halfEdge === halfEdge0) {\r\n            this.removeCycle(path);\r\n            this.state.districts.push(path.map(halfEdge => halfEdge.target));\r\n            return true;\r\n        }\r\n\r\n        path.push(halfEdge);\r\n        depth++;\r\n    }\r\n    return false;\r\n};\r\n\r\nlayoutGenerator.prototype.cycleFrom = function(edge) {\r\n    this.cycleFromHalfEdge(edge.forw);\r\n    this.cycleFromHalfEdge(edge.back);\r\n};\r\n\r\nlayoutGenerator.prototype.generate = function(t) {\r\n    this.state.streets.nodes.filter(function(node) {\r\n        return node.pivots.length > 0;\r\n    }).forEach(function(node, i, a) {\r\n        var dir = node.pivot() + prng(-this.state.spread, this.state.spread);\r\n        var len = prng(this.state.short, this.state.long);\r\n\r\n        var newEdge = mapEdge(node, mapNode(0, 0))\r\n            .offset(dir, len);\r\n\r\n        var cropDown = newEdge.adapt(this.state.streets.edges, dir, this.addEdge.bind(this), this.state.snapR);\r\n        var cropUp = false;\r\n        if (!cropDown) {\r\n            cropUp = newEdge.offset(dir, 1.5 * len)\r\n                .adapt(this.state.streets.edges, dir, this.addEdge.bind(this), this.state.snapR);\r\n            if (!cropUp)\r\n                newEdge.offset(dir, len);\r\n        }\r\n\r\n        if (cropDown || cropUp) {\r\n            this.cycleFrom(newEdge);\r\n        }\r\n\r\n        if (!this.state.streets.edges.some(newEdge.eq, newEdge)) {\r\n            var resNode = newEdge.to;\r\n            if (this.state.streets.nodes.indexOf(resNode) === -1)\r\n                this.state.streets.nodes.push(resNode);\r\n\r\n            this.addEdge(newEdge);\r\n        }\r\n    }, this);\r\n\r\n    return this;\r\n};\r\n\r\n\r\nwindow.randi = randi;\r\nmodule.exports = layoutGenerator;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layoutGenerator.js\n **/","function norm(a) {\r\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1]);\r\n}\r\n\r\nfunction dot(a, b) {\r\n    return a[0] * b[0] + a[1] * b[1];\r\n}\r\n\r\nfunction cross(a, b) {\r\n    return a[0] * b[1] - a[1] * b[0];\r\n}\r\n\r\nfunction rescale(a, l) {\r\n    var na = norm(a);\r\n    return [\r\n        a[0] / na * l,\r\n        a[1] / na * l\r\n    ];\r\n}\r\n\r\nfunction scalar(n, x) {\r\n    return [n * x[0], n * x[1]];\r\n}\r\n\r\nfunction sum(a, b) {\r\n    return [a[0] + b[0], a[1] + b[1]];\r\n}\r\n\r\nfunction times(n, a) {\r\n    return [n * a[0], n * a[1]];\r\n}\r\n\r\nfunction sub(a, b, into) {\r\n    if (into) {\r\n        into[0] = a[0] - b[0];\r\n        into[1] = a[1] - b[1];\r\n        return into;\r\n    }\r\n    return [a[0] - b[0], a[1] - b[1]];\r\n}\r\n\r\nfunction dist (c1, c2) {\r\n    return Math.sqrt(Math.pow(c1[0] - c2[0], 2) + Math.pow(c1[1] - c2[1], 2))\r\n};\r\n\r\nvar vec = {\r\n    norm: norm,\r\n    dot: dot,\r\n    cross: cross,\r\n    rescale: rescale,\r\n    scalar: scalar,\r\n    sum: sum,\r\n    sub: sub,\r\n    dist: dist\r\n};\r\n\r\nmodule.exports = vec;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/vec.js\n **/","function mapNode(x, y) {\r\n    if (!(this instanceof mapNode))\r\n        return new mapNode(x, y);\r\n    this.pos = [x, y];\r\n    this.pivots = [];\r\n    this.halfEdges = [];\r\n    this.isActive = true;\r\n}\r\n\r\nmapNode.prototype.pivot = function () {\r\n    var pivotI = randi(this.pivots.length);\r\n    return this.pivots.splice(pivotI, 1)[0];\r\n};\r\n\r\nmodule.exports = mapNode;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/mapNode.js\n **/","function mapHalfEdge(edge, invert) {\r\n    if (!(this instanceof mapHalfEdge))\r\n        return new mapHalfEdge(edge, invert);\r\n\r\n    this.free = true;\r\n    this.invert = Boolean(invert);\r\n    this.source = invert? edge.to: edge.from;\r\n    this.target = invert? edge.from: edge.to;\r\n    this.dir = (!invert)? edge.getDir(): (edge.getDir() + Math.PI) % (2 * Math.PI);\r\n\r\n    edge[invert? 'back': 'forw'] = this;\r\n    this.source.halfEdges.push(this);\r\n}\r\n\r\nmapHalfEdge.prototype.next = function() {\r\n    var twin = this.twin;\r\n    var dir = this.twin.dir;\r\n    var bestMatch = this.target.halfEdges.reduce(function(best, halfEdge) {\r\n        if (halfEdge.free == false || halfEdge === twin)\r\n            return best;\r\n        var rot = halfEdge.dir - dir;\r\n        while (rot < 0) rot += Math.PI * 2; // FIXME why all the wild variation in angles?\r\n        if (rot < best.score) {\r\n            best.halfEdge = halfEdge;\r\n            best.score = rot;\r\n        }\r\n        return best;\r\n    }, { score: Infinity})\r\n    // console.log(bestMatch.score)\r\n    return bestMatch.halfEdge;\r\n};\r\n\r\nmapHalfEdge.prototype.setSource = function (into) {\r\n    var old = this.source;\r\n    old.halfEdges.splice(old.halfEdges.indexOf(this), 1);\r\n    this.source = into;\r\n    into.halfEdges.push(this);\r\n    return this;\r\n};\r\n\r\nmodule.exports = mapHalfEdge;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/mapHalfEdge.js\n **/","var vec = require('./vec.js');\r\nvar mapHalfEdge = require('./mapHalfEdge.js');\r\n\r\n\r\nvar swapArr2 = [0, 0];\r\n\r\nfunction mapEdge(node1, node2) {\r\n    if (!(this instanceof mapEdge))\r\n        return new mapEdge(node1, node2);\r\n    this.from = node1;\r\n    this.to = node2;\r\n    this.selfVec = [0, 0];\r\n\r\n    var halfEdgeForw = mapHalfEdge(this);\r\n    var halfEdgeBack = mapHalfEdge(this, true);\r\n    halfEdgeForw.twin = halfEdgeBack;\r\n    halfEdgeBack.twin = halfEdgeForw;\r\n\r\n    this.recomputeVec();\r\n}\r\n\r\nmapEdge.prototype.offset = function(dir, len) {\r\n    this.to.pos[0] = this.from.pos[0] + Math.sin(dir) * len;\r\n    this.to.pos[1] = this.from.pos[1] + Math.cos(dir) * len;\r\n    this.recomputeVec();\r\n    return this;\r\n}\r\n\r\nmapEdge.prototype.intersects = function(edge2) {\r\n    // http://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect\r\n    var p = this.from.pos;\r\n    var r = this.selfVec;\r\n    var s = edge2.selfVec;\r\n    var subqp = vec.sub(edge2.from.pos, p, swapArr2);\r\n    var crossrs = vec.cross(r, s);\r\n\r\n    if (crossrs == 0)\r\n        return false;\r\n    var u = vec.cross(subqp, r) / crossrs;\r\n    if (u <= 0 || u >= 1)\r\n        return false;\r\n    var t = vec.cross(subqp, s) / crossrs;\r\n    if (t <= 0 || t >= 1)\r\n        return false;\r\n    return vec.sum(p, vec.scalar(t, r));\r\n}\r\n\r\nmapEdge.prototype.crop = function(node) {\r\n    var temp = this.to;\r\n    this.to = node;\r\n\r\n    // update half-edges\r\n    this.forw.target = node;\r\n    this.back.setSource(node);\r\n\r\n    this.recomputeVec();\r\n\r\n    var rest = mapEdge(node, temp); // WATCH used to have recomuteVec\r\n    // rest.forw.free = this.forw.free;\r\n    // rest.back.free = this.back.free;\r\n\r\n    return rest;\r\n};\r\n\r\nmapEdge.prototype.adapt = function(edges, dir, edgePush, r) {\r\n    var newNode = this.to;\r\n\r\n    var conflictEdge = null;\r\n    edges.forEach(function(edge) {\r\n        var newPos = this.intersects(edge);\r\n        if (newPos) {\r\n            newNode.pos[0] = newPos[0];\r\n            newNode.pos[1] = newPos[1];\r\n            this.recomputeVec();\r\n            conflictEdge = edge;\r\n        }\r\n    }, this);\r\n\r\n    if (conflictEdge) {\r\n        if (!this.snapToEdge(conflictEdge, r)) {\r\n            edgePush(conflictEdge.crop(newNode));\r\n            newNode.pivots.push(dir);\r\n        }\r\n    } else {\r\n        newNode.pivots.push(dir, dir + .5 * Math.PI, dir - .5 * Math.PI);\r\n    }\r\n\r\n    return conflictEdge !== null;\r\n};\r\n\r\nmapEdge.prototype.snapToNode = function (node, r) {\r\n    if (vec.dist(this.to.pos, node.pos) < r) {\r\n        this.to = node;\r\n        this.recomputeVec();\r\n\r\n        // update half-edges\r\n        var dir = this.getDir();\r\n        this.forw.target = node;\r\n        this.forw.dir = dir;\r\n        this.back.setSource(node);\r\n        this.back.dir = (dir + Math.PI) % (2 * Math.PI);\r\n\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n\r\nmapEdge.prototype.snapToEdge = function(edge, r) {\r\n    return this.snapToNode(edge.to, r) || this.snapToNode(edge.from, r);\r\n};\r\n\r\nmapEdge.prototype.recomputeVec = function() {\r\n    vec.sub(this.to.pos, this.from.pos, this.selfVec);\r\n    var dir = this.getDir();\r\n    if (this.forw) this.forw.dir = dir\r\n    if (this.back) this.back.dir = (dir + Math.PI) % (2 * Math.PI);\r\n    return this;\r\n};\r\n\r\nmapEdge.prototype.getDir = function() {\r\n    var temp = (this.selfVec[1] > 0? 1: -1) * Math.acos(this.selfVec[0] / vec.norm(this.selfVec));\r\n    // FIXME why is edge length 0?\r\n    return isNaN(temp)? 0: temp;\r\n};\r\n\r\nmapEdge.prototype.eq = function(edge) {\r\n    return edge.from === this.from && edge.to === this.to;\r\n};\r\n\r\nmodule.exports = mapEdge;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/mapEdge.js\n **/"],"sourceRoot":""}